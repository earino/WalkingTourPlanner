<!DOCTYPE html>
<html>
<head>
  <title>Chiang Mai Temple Tour - A Spiritual Journey</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { margin: 0; font-family: Georgia, serif; background: #f5f5f5; }
    #map { height: 100vh; width: 100%; }
    .sidebar {
      position: absolute; top: 0; left: 0; width: 400px; height: 100vh;
      background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      overflow-y: auto; z-index: 1000;
    }
    .header {
      padding: 30px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .header h1 { margin: 0 0 10px; font-size: 28px; font-weight: 600; }
    .header p { margin: 0; opacity: 0.95; font-size: 14px; line-height: 1.6; }
    .stats {
      padding: 20px 25px; background: #f8f9fa; border-bottom: 1px solid #e1e4e8;
    }
    .stat-row {
      display: flex; justify-content: space-between; margin: 8px 0;
      font-size: 14px;
    }
    .stat-row strong { color: #2c3e50; }
    .temples-list { padding: 0 15px 20px; }
    .temple-card {
      margin: 15px 0; padding: 15px; background: white;
      border: 1px solid #e1e4e8; border-radius: 8px;
      cursor: pointer; transition: all 0.2s;
    }
    .temple-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px);
    }
    .temple-number {
      display: inline-block; width: 32px; height: 32px;
      background: #4A90E2; color: white; border-radius: 50%;
      text-align: center; line-height: 32px; font-weight: bold;
      margin-right: 12px; font-size: 14px;
    }
    .temple-card.start .temple-number { background: #00FF00; }
    .temple-card.end .temple-number { background: #FF0000; }
    .temple-name { font-size: 16px; font-weight: 600; color: #333; margin: 0 0 10px; }
    .temple-desc { font-size: 13px; line-height: 1.6; color: #555; margin: 10px 0; }
    .temple-nav {
      margin-top: 12px; padding-top: 12px; border-top: 1px solid #e1e4e8;
    }
    .nav-link {
      display: inline-block; padding: 8px 16px; background: #4285f4;
      color: white; text-decoration: none; border-radius: 6px;
      font-size: 13px; font-weight: 600;
    }
    .nav-link:hover { background: #357ae8; }
    @media (max-width: 768px) {
      .sidebar { width: 100%; height: 40vh; }
      #map { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="header">
      <h1>üèØ Chiang Mai Temple Tour</h1>
      <p id="overview">Loading...</p>
    </div>
    <div class="stats">
      <div class="stat-row"><span>Temples</span><strong id="count">-</strong></div>
      <div class="stat-row"><span>Distance</span><strong id="distance">-</strong></div>
      <div class="stat-row"><span>Walking Time</span><strong id="walk">-</strong></div>
      <div class="stat-row"><span>Total Time</span><strong id="total">-</strong></div>
    </div>
    <div class="temples-list" id="temples"></div>
  </div>
  <div id="map"></div>

  <script>
    fetch('./data/temple-tour-with-narrative.json')
      .then(r => r.json())
      .then(tour => {
        // Update header
        document.getElementById('overview').textContent = tour.overview || 'A spiritual journey through Chiang Mai Old Town';
        document.getElementById('count').textContent = tour.temples.length;
        document.getElementById('distance').textContent = (tour.metadata.distance/1000).toFixed(2) + ' km';
        document.getElementById('walk').textContent = Math.round(tour.metadata.walkingTime/60) + ' min';
        document.getElementById('total').textContent = Math.floor(tour.metadata.totalTime/3600) + 'h ' + Math.round((tour.metadata.totalTime%3600)/60) + 'm';

        // Initialize map
        const map = L.map('map').setView([18.7883, 98.9853], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap'
        }).addTo(map);

        // Draw route
        const allCoords = [];
        tour.route.geometry.coordinates.forEach(seg => {
          const ll = seg.map(c => [c[1], c[0]]);
          allCoords.push(...ll);
          L.polyline(ll, {color: '#FF6B35', weight: 5, opacity: 0.7}).addTo(map);
        });
        map.fitBounds(L.latLngBounds(allCoords), {padding: [50, 50]});

        // Add temples
        const list = document.getElementById('temples');
        tour.temples.forEach((temple, idx) => {
          const isStart = idx === 0;
          const isEnd = idx === tour.temples.length - 1;
          const color = isStart ? '#00FF00' : isEnd ? '#FF0000' : '#4A90E2';

          // Marker
          const icon = L.divIcon({
            html: '<div style="background:' + color + ';color:white;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3)">' + (idx+1) + '</div>',
            iconSize: [32, 32], iconAnchor: [16, 16]
          });

          const marker = L.marker([temple.latitude, temple.longitude], {icon}).addTo(map);

          // Temple card
          const card = document.createElement('div');
          card.className = 'temple-card' + (isStart ? ' start' : isEnd ? ' end' : '');
          card.innerHTML = 
            '<div><span class="temple-number">' + (idx+1) + '</span>' +
            '<span class="temple-name">' + temple.name + '</span></div>' +
            '<div class="temple-desc">' + (temple.aiDescription || temple.name) + '</div>' +
            '<div class="temple-nav">' +
            '<a href="https://www.google.com/maps/dir/?api=1&destination=' + 
            temple.latitude + ',' + temple.longitude + 
            '&travelmode=walking" target="_blank" class="nav-link">üìç Navigate Here</a>' +
            '</div>';

          card.onclick = () => {
            map.setView([temple.latitude, temple.longitude], 17);
            marker.openPopup();
            card.scrollIntoView({behavior: 'smooth', block: 'center'});
          };

          list.appendChild(card);
        });
      })
      .catch(err => {
        document.getElementById('overview').textContent = 'Error loading tour: ' + err.message;
      });
  </script>
</body>
</html>
